<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Debug Test</title>
    <style>
        body { 
            font-family: system-ui, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f9fafb;
        }
        .test-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .success { border-color: #22c55e; background: #f0fdf4; }
        .error { border-color: #ef4444; background: #fef2f2; color: #dc2626; }
        .status { margin: 8px 0; padding: 8px; border-radius: 4px; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
        }
    </style>
</head>
<body>
    <h1>üîç App Debug Test</h1>
    <div id="results"></div>
    <div id="app-container"></div>

    <script type="module">
        const results = document.getElementById('results');
        const appContainer = document.getElementById('app-container');
        
        function addTest(title, test) {
            const section = document.createElement('div');
            section.className = 'test-section';
            results.appendChild(section);
            
            try {
                const result = test();
                section.className += ' success';
                section.innerHTML = `<strong>‚úÖ ${title}</strong><br>${result}`;
                return true;
            } catch (error) {
                section.className += ' error';
                section.innerHTML = `<strong>‚ùå ${title}</strong><br>Error: ${error.message}`;
                console.error(title, error);
                return false;
            }
        }

        // Test 1: localStorage (your app uses this heavily)
        addTest('localStorage Access', () => {
            localStorage.setItem('test-key', 'test-value');
            const value = localStorage.getItem('test-key');
            localStorage.removeItem('test-key');
            if (value !== 'test-value') throw new Error('localStorage not working');
            return 'localStorage read/write works';
        });

        // Test 2: JSON operations (your app uses this for localStorage)
        addTest('JSON Operations', () => {
            const testObj = {
                userId: 'user_123',
                preferences: {
                    theme: 'light',
                    soundEnabled: true
                }
            };
            const json = JSON.stringify(testObj);
            const parsed = JSON.parse(json);
            if (parsed.preferences.theme !== 'light') throw new Error('JSON parse failed');
            return 'JSON stringify/parse works';
        });

        // Test 3: Date operations (your app uses Date heavily)
        addTest('Date Operations', () => {
            const now = new Date();
            const dateString = now.toLocaleDateString();
            const timeString = now.toLocaleDateString("en-US", {
                weekday: "long", year: "numeric", month: "long", day: "numeric"
            });
            return `Date operations work: ${dateString}`;
        });

        // Test 4: Set operations (your completedSessions)
        addTest('Set Operations', () => {
            const testSet = new Set();
            testSet.add('session1');
            testSet.add('session2');
            const array = [...testSet];
            if (array.length !== 2) throw new Error('Set operations failed');
            return `Set works: ${array.join(', ')}`;
        });

        // Test 5: Try to create your actual userProfile structure
        addTest('UserProfile Structure', () => {
            const userProfile = {
                userId: 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: 'ADHD Warrior',
                startDate: new Date().toLocaleDateString(),
                currentWeek: 1,
                preferences: {
                    notifications: true,
                    exerciseType: 'mixed',
                    reminderTime: '09:00',
                    soundEnabled: true,
                    theme: 'light',
                    highContrast: false,
                    reduceMotion: false,
                    extendedBreaks: false,
                    skipComplex: false
                }
            };
            
            // Test the exact localStorage operation your app does
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            const saved = localStorage.getItem('userProfile');
            const parsed = JSON.parse(saved);
            
            if (parsed.preferences.theme !== 'light') throw new Error('UserProfile save/load failed');
            
            return `UserProfile structure works: ${parsed.name}`;
        });

        // Test 6: Try a minimal version of your actual App component
        setTimeout(async () => {
            try {
                const React = await import('https://esm.sh/react@19.1.1');
                const ReactDOM = await import('https://esm.sh/react-dom@19.1.1/client');
                
                const MiniApp = () => {
                    const [currentScreen, setCurrentScreen] = React.useState('home');
                    
                    // Simulate your userProfile state
                    const [userProfile] = React.useState(() => {
                        const saved = localStorage.getItem('userProfile');
                        return saved ? JSON.parse(saved) : {
                            name: 'Test User',
                            currentWeek: 1,
                            preferences: { theme: 'light', soundEnabled: true }
                        };
                    });
                    
                    return React.createElement('div', {
                        style: {
                            background: '#f9fafb',
                            padding: '20px',
                            borderRadius: '8px',
                            border: '2px solid #3b82f6'
                        }
                    }, [
                        React.createElement('h2', { key: 'title' }, 'üéâ Mini App Works!'),
                        React.createElement('p', { key: 'user' }, `User: ${userProfile.name}`),
                        React.createElement('p', { key: 'week' }, `Week: ${userProfile.currentWeek}`),
                        React.createElement('button', {
                            key: 'btn',
                            onClick: () => setCurrentScreen(currentScreen === 'home' ? 'test' : 'home'),
                            style: {
                                background: '#3b82f6',
                                color: 'white',
                                border: 'none',
                                padding: '12px 24px',
                                borderRadius: '8px',
                                cursor: 'pointer'
                            }
                        }, `Current: ${currentScreen}`)
                    ]);
                };
                
                const reactRoot = ReactDOM.createRoot(appContainer);
                reactRoot.render(React.createElement(MiniApp));
                
                addTest('Mini App Render', () => 'React app with localStorage state rendered successfully!');
                
            } catch (error) {
                addTest('Mini App Render', () => { throw error; });
            }
        }, 1000);
    </script>
</body>
</html>